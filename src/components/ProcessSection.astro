---
import { Image } from 'astro:assets';
import clarityIco from '../assets/clarity_ico.svg';
import keyIcon from '../assets/key.svg';
import gauntlet from '../assets/guantlet.svg';
import figma from '../assets/figma.svg';
import cursor from '../assets/cursor.svg';
import claude from '../assets/claude.svg';
import ps from '../assets/ps.svg';
import ai from '../assets/ai.svg';
import clarity from '../assets/clarity.png';
---

<section id="process" class="process" data-process>
	<canvas class="process__particles" aria-hidden="true"></canvas>
	<div class="container process__container">
		<h2 class="process__title fade-in">How I work</h2>
		
		<!-- Three principle cards -->
		<div class="process__cards">
			<article class="process__card fade-in" data-parallax data-speed="0.15">
				<div class="process__icon">
					<img src={clarityIco.src} alt="" aria-hidden="true" />
				</div>
				<h3 class="process__card-title">Clarity from chaos</h3>
				<p class="process__card-text">I build process where there is none.</p>
			</article>

			<article class="process__card fade-in" data-parallax data-speed="0.2" style="transition-delay: 0.1s;">
				<div class="process__icon">
					<img src={keyIcon.src} alt="" aria-hidden="true" />
				</div>
				<h3 class="process__card-title">Listening is key</h3>
				<p class="process__card-text">The best design starts with paying attention.</p>
			</article>

			<article class="process__card fade-in" data-parallax data-speed="0.25" style="transition-delay: 0.2s;">
				<div class="process__icon">
					<img src={gauntlet.src} alt="" aria-hidden="true" />
				</div>
				<h3 class="process__card-title">Hands on work</h3>
				<p class="process__card-text">From user flows to visual details.</p>
			</article>
		</div>

		<!-- Quote and context section -->
		<div class="process__content">
			<div class="process__quote fade-in">
				<p>I believe the best design work happens when we have a seat at the strategy table.</p>
			</div>
			
			<div class="process__context fade-in">
				<p class="process__philosophy">
					Designers need a voice at the strategy level to deliver the best work. That means digging into the why alongside engineers and product owners, not just executing decisions. Our work requires trade-offs. Knowing where to make them is the difference between shipping something that works and shipping something we're proud of.
				</p>
				
				<div class="process__tools">
					<p class="process__tools-label">Current toolbox:</p>
					<div class="process__tools-icons">
						<div class="tool-icon">
							<img src={figma.src} alt="Figma" />
						</div>
						
						<div class="tool-icon">
							<img src={cursor.src} alt="Cursor" />
						</div>
						<div class="tool-icon">
							<img src={claude.src} alt="Claude" />
						</div>
						<div class="tool-icon tool-icon--clarity">
							<Image 
								src={clarity} 
								alt="Clarity" 
								width={65}
								height={65}
								format="webp"
								quality={80}
								loading="lazy"
							/>
						</div>
						<div class="tool-icon">
							<img src={ps.src} alt="Photoshop" />
						</div>
						<div class="tool-icon">
							<img src={ai.src} alt="Illustrator" />
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>

<style>
	.process {
		position: relative;
		padding: 6rem 0 5rem;
		background: none;
		overflow: hidden;
	}

	.process__particles {
		position: absolute;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		z-index: 0;
		pointer-events: none;
		opacity: 0.5;
		will-change: contents;
	}

	.process__container {
		position: relative;
		z-index: 1;
	}

	.process__title {
		font-family: 'Grenze Gotisch', var(--font-display);
		font-size: clamp(6rem, 6vw, 4.5rem);
		color: var(--color-accent);
		margin-bottom: 3rem;
		text-align: center;
		font-weight: 300;
		letter-spacing: 0.02em;
	}

	/* Three principle cards */
	.process__cards {
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		gap: 2.25rem;
		margin-bottom: 5rem;
	}

	.process__card {
		background: rgba(33, 32, 28, 0.8);
		backdrop-filter: blur(2px);
		border-radius: 8px;
		padding: 1.5rem;
		display: flex;
		flex-direction: column;
		align-items: center;
		text-align: center;
		gap: 0.75rem;
		transition: all 0.3s ease;
	}



	.process__icon {
		height: 67px;
		display: flex;
		align-items: center;
		justify-content: center;
		margin-bottom: 0.5rem;
	}

	.process__icon img {
		height: 100%;
		width: auto;
		object-fit: contain;
		filter: brightness(0) saturate(100%) invert(78%) sepia(30%) saturate(466%) hue-rotate(8deg) brightness(94%) contrast(88%);
	}

	.process__card-title {
		font-family: 'Grenze', var(--font-display);
		font-size: 2rem;
		font-weight: 300;
		color: #eee5c6;
		margin: 0;
		line-height: 1.2;
	}

	.process__card-text {
		font-size: 1rem;
		color: #e7d2b4;
		margin: 0;
		line-height: 1.5;
	}

	/* Quote and context section */
	.process__content {
		display: grid;
		grid-template-columns: 1fr 1.2fr;
		gap: 6rem;
		align-items: start;
	}

	.process__quote {
		position: sticky;
		top: 6rem;
		background: transparent;
		box-shadow: none;
	}

	.process__quote p {
		font-family: var(--font-display);
		font-size: 4rem;
		line-height: 1;
		color: var(--color-accent);
		margin: 0;
		font-weight: 300;
	}

	.process__quote .highlight {
		font-weight: 600;
		color: var(--color-accent);
		text-shadow: 0 0 20px var(--color-accent-dim), 0 0 40px var(--color-accent-dim);
	}

	.process__context {
		display: flex;
		flex-direction: column;
		gap: 2.5rem;
	}

	.process__philosophy {
		font-size: 1rem;
		line-height: 1.75;
		color: #F3EAD0;
		margin: 0;
	}

	.process__tools {
		display: flex;
		flex-direction: column;
		gap: 1.75rem;
	}

	.process__tools-label {
		font-family: 'Grenze', var(--font-display);
		font-size: 1.5rem;
		color: #D0B65F;
		margin: 0;
		font-weight: 500;
	}

	.process__tools-icons {
		display: flex;
		gap: 1rem;
		flex-wrap: wrap;
	}

	.tool-icon {
		width: 65px;
		height: 65px;
		background: #000;
		border-radius: 15px;
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 0.75rem;
		transition: transform 0.2s ease;
	}




	.tool-icon img {
		width: 100%;
		height: 100%;
		object-fit: contain;
	}

	@media (prefers-reduced-motion: reduce) {
		.process__card {
			transition: none;
		}
	}

	@media (max-width: 1024px) {
		.process__cards {
			grid-template-columns: 1fr;
			gap: 1.5rem;
			margin-bottom: 4rem;
		}

		.process__content {
			grid-template-columns: 1fr;
			gap: 3rem;
		}

		.process__quote {
			position: static;
		}

		.process__quote p {
			font-size: clamp(2rem, 5vw, 3rem);
		}
	}

	@media (max-width: 640px) {
		.process {
			padding: 4rem 0 3rem;
		}

		.process__title {
			font-size: 2.5rem;
			color: var(--color-accent);
			margin-bottom: 2rem;
		}

		.process__card {
			padding: 1.25rem;
		}

		.process__card-title {
			font-size: 1.5rem;
		}

		.process__philosophy {
			font-size: 1.125rem;
		}

		.process__tools-icons {
			gap: 0.75rem;
		}

		.tool-icon {
			width: 56px;
			height: 56px;
		}
	}
</style>

<script>
	const process = document.querySelector('[data-process]') as HTMLElement | null;
	const canvas = document.querySelector('.process__particles') as HTMLCanvasElement | null;
	
	// Particle animation
	if (canvas && process) {
		const ctx = canvas.getContext('2d');
		let particles: { x: number; y: number; vx: number; vy: number; size: number; life: number; decay: number; hue: number; alpha: number }[] = [];
		let mouseX = 0;
		let mouseY = 0;
		let animationId: number | null = null;

		const resize = () => {
			canvas.width = process.clientWidth;
			canvas.height = process.clientHeight;
		};

		const initParticles = () => {
			// Reduce particle count on mobile for better performance
			const isMobile = window.innerWidth < 768;
			const count = isMobile ? 40 : 80;
			particles = Array.from({ length: count }).map(() => ({
				x: Math.random() * canvas.width,
				y: Math.random() * canvas.height,
				vx: (Math.random() - 0.5) * 0.3,
				vy: (Math.random() - 0.5) * 0.3,
				size: Math.random() * 2 + 0.5,
				life: Math.random(),
				decay: Math.random() * 0.003 + 0.001,
				hue: 40 + Math.random() * 20,
				alpha: 0.2 + Math.random() * 0.3,
			}));
		};

		const animate = () => {
			if (!ctx) return;
			
			ctx.clearRect(0, 0, canvas.width, canvas.height);

			particles.forEach((p) => {
				// Mouse interaction
				const dx = p.x - mouseX;
				const dy = p.y - mouseY;
				const dist = Math.sqrt(dx * dx + dy * dy);
				if (dist < 120) {
					const force = (1 - dist / 120) * 0.3;
					const angle = Math.atan2(dy, dx);
					p.vx += Math.cos(angle) * force * -1;
					p.vy += Math.sin(angle) * force * -1;
				}

				// Gentle floating motion
				p.x += p.vx + Math.sin(Date.now() * 0.0008 + p.y * 0.01) * 0.1;
				p.y += p.vy + Math.cos(Date.now() * 0.0008 + p.x * 0.01) * 0.08;
				p.vx *= 0.99;
				p.vy *= 0.99;
				p.life -= p.decay;

				// Reset particle if dead or out of bounds
				if (p.life <= 0 || p.x < 0 || p.x > canvas.width || p.y < 0 || p.y > canvas.height) {
					p.x = Math.random() * canvas.width;
					p.y = Math.random() * canvas.height;
					p.vx = (Math.random() - 0.5) * 0.2;
					p.vy = (Math.random() - 0.5) * 0.2;
					p.life = 1;
				}

				// Draw particle
				ctx.beginPath();
				ctx.fillStyle = `hsla(${p.hue}, 45%, 55%, ${p.alpha * p.life})`;
				ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
				ctx.fill();

				// Draw glow
				ctx.beginPath();
				ctx.fillStyle = `hsla(${p.hue}, 50%, 65%, ${p.alpha * 0.2 * p.life})`;
				ctx.arc(p.x, p.y, p.size * 2.5, 0, Math.PI * 2);
				ctx.fill();
			});

			animationId = requestAnimationFrame(animate);
		};

		resize();
		initParticles();
		animate();

		window.addEventListener('resize', () => {
			resize();
			initParticles();
		});

		if (window.matchMedia('(hover: hover)').matches) {
			process.addEventListener('mousemove', (e) => {
				const rect = process.getBoundingClientRect();
				mouseX = e.clientX - rect.left;
				mouseY = e.clientY - rect.top;
			}, { passive: true });

			process.addEventListener('mouseleave', () => {
				mouseX = canvas.width / 2;
				mouseY = canvas.height / 2;
			});
		}
	}
</script>
